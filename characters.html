<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moriris ‚Äì Characters</title>

  <meta name="description" content="Meet all the gentle creatures from Moriris." />
  <link rel="canonical" href="https://official.moriris.com/characters.html" />

  <style>
    :root{
      --bg:#f6f0c9; --ink:#2f3a33; --ink-soft:#5d6a61;
      --accent:#6aa57a; --accent-dark:#3e7b53;
      --card:rgba(255,253,243,0.9);
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;
      background:var(--bg) url("/assets/hero-forest.jpg") center/cover fixed no-repeat;
      color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;
      line-height:1.7;
    }
    img{max-width:100%;height:auto;display:block}
    a{color:var(--accent-dark);text-decoration:none}
    a:hover{text-decoration:underline}

    .topbar{
      position:fixed;top:0;left:0;right:0;display:flex;justify-content:space-between;
      padding:.6rem 1rem;background:rgba(246,240,201,.7);backdrop-filter:saturate(120%) blur(4px);z-index:5
    }
    .lang-btn{
      border:0;background:#e9f3ec;padding:.4rem .7rem;border-radius:999px;
      font-weight:700;color:var(--accent-dark);cursor:pointer;margin-left:.4rem;
    }
    .lang-btn[aria-pressed="true"]{background:var(--accent);color:#fff}
    .topbar-left a{font-weight:700;}

    main{max-width:1040px;margin:4.5rem auto 3rem;padding:0 1rem}
    .card{
      background:var(--card);border-radius:var(--radius);
      box-shadow:var(--shadow);padding:1.5rem;margin:1rem 0
    }
    h1{margin:0 0 .75rem;font-size:1.8rem}
    h2{margin:0 0 .75rem;font-size:1.4rem}
    .small{font-size:.92rem;color:var(--ink-soft)}

    .tiles{display:grid;gap:1rem;grid-template-columns:repeat(3,1fr);}
    .tile{
      background:#fff;border-radius:14px;overflow:hidden;
      box-shadow:var(--shadow);display:flex;flex-direction:column;height:100%;
    }
    .tile img{width:100%;height:auto}
    .tile-body{padding:.9rem 1rem;display:flex;flex-direction:column;gap:.25rem}
    .name{font-weight:800;}
    .title{font-size:.9rem;color:var(--ink-soft);}
    .desc{font-size:.9rem;}

    .btn{
      display:inline-block;
      background:var(--accent);
      color:#fff;
      padding:.65rem 1.1rem;
      border-radius:12px;
      font-weight:700;
      text-align:center;
    }
    .btn:hover{
      background:var(--accent-dark);
      text-decoration:none;
    }

    @media (max-width:900px){
      .tiles{grid-template-columns:1fr 1fr;}
    }
    @media (max-width:640px){
      .tiles{grid-template-columns:1fr;}
    }
  </style>

  <!-- internal cookie: ?internal=1 „ÅÆÊôÇ„Å†„Åë -->
  <script>
    if (location.search.includes("internal=1")) {
      document.cookie = "moriris_dev=1; path=/; max-age=31536000";
    }
  </script>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HWRX6Q9K3E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    function isInternalTraffic(){
      return document.cookie.includes("moriris_dev=1");
    }
    function isDebug(){
      return location.search.includes("debug=1");
    }

    gtag('js', new Date());
    gtag('consent', 'default', {
      ad_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      analytics_storage: 'granted'
    });
    gtag('config', 'G-HWRX6Q9K3E', {
      debug_mode: isDebug(),
      traffic_type: isInternalTraffic() ? 'internal' : undefined,
      linker: { domains: ['member.moriris.com'] }
    });
  </script>
</head>

<body>
  <div class="topbar">
    <div class="topbar-left">
      <a href="/" data-i18n="back_home" data-ga="nav_back_home">‚Üê Back to top</a>
    </div>
    <div>
      <button class="lang-btn" data-lang="en" aria-pressed="true" data-ga="language_btn_en">EN</button>
      <button class="lang-btn" data-lang="ja" aria-pressed="false" data-ga="language_btn_ja">JP</button>
    </div>
  </div>

  <main>
    <section class="card">
      <h1 data-i18n="char_page_title">ü¶ï Moriris Characters</h1>
      <p class="small" data-i18n="char_page_copy">
        Meet all the gentle creatures who live in the world of Moriris.
      </p>
    </section>

    <section class="card">
      <div id="character-grid" class="tiles"></div>
    </section>

    <section class="card">
      <h2 data-i18n="mem_teaser_title">üå≥ Moriris Membership</h2>
      <p class="small" data-i18n="mem_teaser_copy">
        For those who want to stay a little longer in the forest.
      </p>
      <p style="margin-top:.7rem">
        <a href="/membership.html" class="btn" id="mem-cta" data-i18n="mem_teaser_btn" data-ga="cta_click_membership_page">
          Continue the story
        </a>
      </p>
    </section>
  </main>

  <script>
    // ---------- GA helper ----------
    function gaLang(){
      return localStorage.getItem("moriris_lang") || document.documentElement.lang || "en";
    }
    function gaEvent(name, params){
      if (typeof gtag !== "function") return;
      gtag("event", name, Object.assign({
        page: location.pathname,
        lang: gaLang()
      }, params || {}));
    }

    // click tracking
    document.addEventListener("click", (e) => {
      const a = e.target.closest("a");
      if (!a) return;

      const href = a.getAttribute("href") || "";
      const isExternal = /^https?:\/\//.test(href) && !href.includes(location.hostname);

      const name = a.dataset.ga;
      if (name) {
        gaEvent(name, {
          link_text: (a.textContent || "").trim().slice(0, 80),
          link_url: href,
          outbound: isExternal ? 1 : 0
        });
        return;
      }
      if (isExternal) {
        gaEvent("outbound_click", {
          link_text: (a.textContent || "").trim().slice(0, 80),
          link_url: href
        });
      }
    });

    // scroll depth
    (function(){
      const thresholds = [25, 50, 75, 90];
      const fired = new Set();
      function onScroll(){
        const doc = document.documentElement;
        const scrollTop = window.scrollY || doc.scrollTop;
        const height = Math.max(1, doc.scrollHeight - window.innerHeight);
        const pct = Math.round((scrollTop / height) * 100);
        thresholds.forEach(t => {
          if (pct >= t && !fired.has(t)) {
            fired.add(t);
            gaEvent("scroll_depth", { percent: t });
          }
        });
      }
      window.addEventListener("scroll", onScroll, { passive:true });
      onScroll();
    })();

    // ---------- page logic ----------
    let charactersData = [];
    let currentLang = "en";

    function renderCharacters(){
      const grid = document.getElementById("character-grid");
      if (!grid || !charactersData.length) return;
      const isJa = (currentLang === "ja");

      grid.innerHTML = "";
      charactersData.forEach(ch => {
        const name = isJa ? (ch.name_ja || ch.name_en) : (ch.name_en || ch.name_ja);
        const title = isJa ? (ch.title_ja || ch.title_en) : (ch.title_en || ch.title_ja);
        const desc = isJa ? (ch.description_ja || ch.description_en) : (ch.description_en || ch.description_ja);

        const card = document.createElement("article");
        card.className = "tile";
        card.innerHTML = `
          <img src="${ch.image}" alt="${name}">
          <div class="tile-body">
            <div class="name">${name}</div>
            <div class="title">${title}</div>
            <div class="desc">${desc}</div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    const translations = {
      en:{
        back_home:"‚Üê Back to top",
        char_page_title:"ü¶ï Moriris Characters",
        char_page_copy:"Meet all the gentle creatures who live in the world of Moriris.",
        mem_teaser_title:"üå≥ Moriris Membership",
        mem_teaser_copy:"For those who want to stay a little longer in the forest.",
        mem_teaser_btn:"Continue the story"
      },
      ja:{
        back_home:"‚Üê „Éà„ÉÉ„Éó„Éö„Éº„Ç∏„Å∏Êàª„Çã",
        char_page_title:"ü¶ï „É¢„É™„É™„Çπ„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº",
        char_page_copy:"„É¢„É™„É™„Çπ„ÅÆ‰∏ñÁïå„ÅßÊöÆ„Çâ„Åô‰ª≤Èñì„Åü„Å°„ÇíÁ¥π‰ªã„Åó„Åæ„Åô„ÄÇ",
        mem_teaser_title:"üå≥ „É¢„É™„É™„Çπ „É°„É≥„Éê„Éº„Ç∑„ÉÉ„Éó",
        mem_teaser_copy:"Ê£Æ„ÅÆ‰∏ñÁïå„Å´„ÄÅ„ÇÇ„ÅÜÂ∞ë„Åó„Å†„ÅëÈï∑„Åè„Å®„Å©„Åæ„Çä„Åü„ÅÑ„ÅÇ„Å™„Åü„Å∏„ÄÇ",
        mem_teaser_btn:"„É°„É≥„Éê„Éº„Ç∑„ÉÉ„Éó„ÅÆË©≥Á¥∞„ÇíË¶ã„Çã"
      }
    };

    function setLang(lang){
      const prev = currentLang;
      const dict = translations[lang] || translations.en;
      currentLang = lang;

      document.documentElement.lang = lang;

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const k = el.dataset.i18n;
        if(dict[k] !== undefined) el.textContent = dict[k];
      });

      document.querySelectorAll(".lang-btn").forEach(b =>
        b.setAttribute("aria-pressed", b.dataset.lang===lang)
      );

      localStorage.setItem("moriris_lang", lang);

      if (prev && prev !== lang) {
        gaEvent("language_change", { lang_from: prev, lang_to: lang });
      }

      renderCharacters();
    }

    document.querySelectorAll(".lang-btn").forEach(btn =>
      btn.addEventListener("click", () => setLang(btn.dataset.lang))
    );

    const saved = localStorage.getItem("moriris_lang") || "en";
    setLang(saved);

    fetch("/data/character.json")
      .then(res => {
        if (!res.ok) throw new Error("Failed to load character.json");
        return res.json();
      })
      .then(data => {
        charactersData = Array.isArray(data) ? data : [];
        renderCharacters();
      })
      .catch(err => console.error("Character load error:", err));

    // ‚úÖ Êó¢Â≠ò„ÅÆ„Ç§„Éô„É≥„Éà„ÇÇÁ∂≠ÊåÅÔºà„Éï„Ç°„Éç„É´„Åß‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑÔºâ
    const memCta = document.getElementById("mem-cta");
    if (memCta) {
      memCta.addEventListener("click", () => {
        gaEvent("membership_cta_click", {
          cta_name: "from_characters",
          plan: "none",
          destination: "/membership.html",
          outbound: 0
        });
      });
    }
  </script>
</body>
</html>
